/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter } from '@angular/core';
import { Terminal } from 'xterm';
import * as fit from 'xterm/lib/addons/fit/fit';
import { Subject } from 'rxjs';
var NgTerminalComponent = /** @class */ (function () {
    function NgTerminalComponent() {
        this.keyInputSubject = new Subject();
        this.keyEventSubject = new Subject();
        this.h = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
        this.displayOption = {};
        this.terminalStyle = {}; // height: (this.h / 2) + 'px' };
        this.keyInputEmitter = new EventEmitter();
        this.keyEventEmitter = new EventEmitter();
    }
    Object.defineProperty(NgTerminalComponent.prototype, "_dataSource", {
        get: /**
         * @return {?}
         */
        function () {
            return this.dataSource;
        },
        set: 
        // height: (this.h / 2) + 'px' };
        /**
         * @param {?} ds
         * @return {?}
         */
        function (ds) {
            var _this = this;
            if (this.dataSourceSubscription != null) {
                this.dataSourceSubscription.unsubscribe();
            }
            this.dataSource = ds;
            this.dataSourceSubscription = this.dataSource.subscribe((/**
             * @param {?} data
             * @return {?}
             */
            function (data) {
                _this.write(data);
            }));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgTerminalComponent.prototype, "_displayOption", {
        set: /**
         * @param {?} opt
         * @return {?}
         */
        function (opt) {
            this.setDisplayOption(opt);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @private
     * @return {?}
     */
    NgTerminalComponent.prototype.observableSetup = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.term.on('data', (/**
         * @param {?} input
         * @return {?}
         */
        function (input) {
            _this.keyInputSubject.next(input);
        }));
        this.term.onKey((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            _this.keyEventSubject.next(e);
        }));
        this.keyInputSubjectSubscription = this.keyInputSubject.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            _this.keyInputEmitter.emit(data);
        }));
        this.keyEventSubjectSubscription = this.keyEventSubject.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            _this.keyEventEmitter.emit(e);
        }));
    };
    /**
     * set block or inline-block to #terminal for fitting client or outer element
     */
    /**
     * set block or inline-block to #terminal for fitting client or outer element
     * @private
     * @param {?} isBlock
     * @return {?}
     */
    NgTerminalComponent.prototype.setTerminalBlock = /**
     * set block or inline-block to #terminal for fitting client or outer element
     * @private
     * @param {?} isBlock
     * @return {?}
     */
    function (isBlock) {
        if (isBlock)
            this.terminalStyle['display'] = 'block';
        else
            this.terminalStyle['display'] = 'inline-block';
    };
    /**
     * set dimensions
     */
    /**
     * set dimensions
     * @private
     * @param {?} left
     * @param {?} top
     * @param {?} width
     * @param {?} height
     * @return {?}
     */
    NgTerminalComponent.prototype.setTerminalDimension = /**
     * set dimensions
     * @private
     * @param {?} left
     * @param {?} top
     * @param {?} width
     * @param {?} height
     * @return {?}
     */
    function (left, top, width, height) {
        this.terminalStyle['left'] = left + "px";
        this.terminalStyle['top'] = top + "px";
        this.terminalStyle['width'] = width + "px";
        this.terminalStyle['height'] = height + "px";
    };
    /**
     * remove dimensions
     */
    /**
     * remove dimensions
     * @private
     * @return {?}
     */
    NgTerminalComponent.prototype.removeTerminalDimension = /**
     * remove dimensions
     * @private
     * @return {?}
     */
    function () {
        this.terminalStyle['left'] = undefined;
        this.terminalStyle['top'] = undefined;
        this.terminalStyle['width'] = undefined;
        this.terminalStyle['height'] = undefined;
    };
    /**
     * When a dimension of div changes, fit a terminal in div.
     */
    /**
     * When a dimension of div changes, fit a terminal in div.
     * @return {?}
     */
    NgTerminalComponent.prototype.ngAfterViewChecked = /**
     * When a dimension of div changes, fit a terminal in div.
     * @return {?}
     */
    function () {
        if (this.displayOption.fixedGrid == null)
            fit.fit(this.term);
    };
    /**
     * It creates new terminal in #terminal.
     */
    /**
     * It creates new terminal in #terminal.
     * @return {?}
     */
    NgTerminalComponent.prototype.ngOnInit = /**
     * It creates new terminal in #terminal.
     * @return {?}
     */
    function () {
        Terminal.applyAddon(fit); // Apply the `fit` addon   
        this.term = new Terminal();
        this.term.open(document.getElementById('terminal'));
        this.observableSetup();
    };
    /**
     * clean all resources
     */
    /**
     * clean all resources
     * @return {?}
     */
    NgTerminalComponent.prototype.ngOnDestroy = /**
     * clean all resources
     * @return {?}
     */
    function () {
        if (this.keyInputSubjectSubscription)
            this.keyInputSubjectSubscription.unsubscribe();
        if (this.dataSourceSubscription)
            this.dataSourceSubscription.unsubscribe();
        if (this.keyEventSubjectSubscription) {
            this.keyEventSubjectSubscription.unsubscribe();
        }
    };
    /**
     * @param {?} chars
     * @return {?}
     */
    NgTerminalComponent.prototype.write = /**
     * @param {?} chars
     * @return {?}
     */
    function (chars) {
        this.term.write(chars);
    };
    /**
     * @param {?} opt
     * @return {?}
     */
    NgTerminalComponent.prototype.setDisplayOption = /**
     * @param {?} opt
     * @return {?}
     */
    function (opt) {
        if (opt.fixedGrid != null) {
            console.debug("resizable will be ignored.");
            this.term.resize(opt.fixedGrid.cols, opt.fixedGrid.rows);
            this.setTerminalBlock(false);
            this.removeTerminalDimension();
        }
        else {
            this.removeTerminalDimension();
            this.setTerminalBlock(true);
        }
        this.displayOption = opt;
    };
    Object.defineProperty(NgTerminalComponent.prototype, "keyInput", {
        get: /**
         * @return {?}
         */
        function () {
            return this.keyInputSubject;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgTerminalComponent.prototype, "keyEventInput", {
        get: /**
         * @return {?}
         */
        function () {
            return this.keyEventSubject;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgTerminalComponent.prototype, "underlying", {
        get: /**
         * @return {?}
         */
        function () {
            return this.term;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgTerminalComponent.prototype, "isDraggableOnEdgeActivated", {
        get: /**
         * @return {?}
         */
        function () {
            return this.displayOption.activateDraggableOnEdge != undefined && this.displayOption.fixedGrid == undefined;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * After user coordinate dimensions of terminal, it's called.
     * @param left
     * @param top
     * @param width
     * @param height
     */
    /**
     * After user coordinate dimensions of terminal, it's called.
     * @param {?} left
     * @param {?} top
     * @param {?} width
     * @param {?} height
     * @return {?}
     */
    NgTerminalComponent.prototype.onResizeEnd = /**
     * After user coordinate dimensions of terminal, it's called.
     * @param {?} left
     * @param {?} top
     * @param {?} width
     * @param {?} height
     * @return {?}
     */
    function (left, top, width, height) {
        this.setTerminalDimension(left, top, width, height);
    };
    /**
     * Before onResizeEnd is called, it valiates dimensions to change.
     * @param re dimension to be submitted from resizable stuff
     */
    /**
     * Before onResizeEnd is called, it valiates dimensions to change.
     * @return {?}
     */
    NgTerminalComponent.prototype.validatorFactory = /**
     * Before onResizeEnd is called, it valiates dimensions to change.
     * @return {?}
     */
    function () {
        /** @type {?} */
        var comp = this;
        return (/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            /** @type {?} */
            var displayOption = comp.displayOption;
            if (displayOption.activateDraggableOnEdge) {
                /** @type {?} */
                var left = re.rectangle.left;
                /** @type {?} */
                var top_1 = re.rectangle.top;
                /** @type {?} */
                var width = re.rectangle.width;
                /** @type {?} */
                var height = re.rectangle.height;
                if ((width < displayOption.activateDraggableOnEdge.minWidth) || (height < displayOption.activateDraggableOnEdge.minHeight)) {
                    return false;
                }
                else
                    return true;
            }
        });
    };
    NgTerminalComponent.decorators = [
        { type: Component, args: [{
                    selector: 'ng-terminal',
                    template: "<global-style></global-style>\r\n\r\n<div id=\"terminal\" class=\"terminal-outer\" mwlResizable [ngStyle]=\"terminalStyle\" [validateResize]=\"validatorFactory()\" [enableGhostResize]=\"true\" [resizeEdges]=\"isDraggableOnEdgeActivated ? {bottom: true, right: true} : {bottom: false, right: false}\"\r\n(resizeEnd)=\"onResizeEnd($event.rectangle.left, $event.rectangle.top, $event.rectangle.width, $event.rectangle.height)\">\r\n</div>",
                    styles: [".terminal-outer{box-sizing:border-box;border:3px solid #429bf4;height:100%}"]
                }] }
    ];
    /** @nocollapse */
    NgTerminalComponent.ctorParameters = function () { return []; };
    NgTerminalComponent.propDecorators = {
        _dataSource: [{ type: Input, args: ['dataSource',] }],
        _displayOption: [{ type: Input, args: ['displayOption',] }],
        keyInputEmitter: [{ type: Output, args: ['keyInput',] }],
        keyEventEmitter: [{ type: Output, args: ['keyEvent',] }]
    };
    return NgTerminalComponent;
}());
export { NgTerminalComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.term;
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.keyInputSubject;
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.keyEventSubject;
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.keyInputSubjectSubscription;
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.keyEventSubjectSubscription;
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.h;
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.displayOption;
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.dataSource;
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.dataSourceSubscription;
    /** @type {?} */
    NgTerminalComponent.prototype.terminalStyle;
    /** @type {?} */
    NgTerminalComponent.prototype.keyInputEmitter;
    /** @type {?} */
    NgTerminalComponent.prototype.keyEventEmitter;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctdGVybWluYWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmctdGVybWluYWwvIiwic291cmNlcyI6WyJsaWIvbmctdGVybWluYWwuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUE0QixLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUM1RyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sT0FBTyxDQUFDO0FBQ2pDLE9BQU8sS0FBSyxHQUFHLE1BQU0sMEJBQTBCLENBQUM7QUFFaEQsT0FBTyxFQUFFLE9BQU8sRUFBNEIsTUFBTSxNQUFNLENBQUM7QUFJekQ7SUE0Q0U7UUFyQ1Esb0JBQWUsR0FBb0IsSUFBSSxPQUFPLEVBQVUsQ0FBQztRQUN6RCxvQkFBZSxHQUFHLElBQUksT0FBTyxFQUEyQyxDQUFDO1FBS3pFLE1BQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsWUFBWSxFQUFFLE1BQU0sQ0FBQyxXQUFXLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDN0Usa0JBQWEsR0FBa0IsRUFBRSxDQUFDO1FBRzFDLGtCQUFhLEdBQVcsRUFBRSxDQUFDLENBQUEsaUNBQWlDO1FBc0I1RCxvQkFBZSxHQUFJLElBQUksWUFBWSxFQUFVLENBQUM7UUFHOUMsb0JBQWUsR0FBSSxJQUFJLFlBQVksRUFBMkMsQ0FBQztJQUUvRCxDQUFDO0lBekJqQixzQkFDSSw0Q0FBVzs7OztRQVNmO1lBQ0UsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBQ3pCLENBQUM7Ozs7Ozs7UUFaRCxVQUNnQixFQUFFO1lBRGxCLGlCQVNDO1lBUEMsSUFBRyxJQUFJLENBQUMsc0JBQXNCLElBQUksSUFBSSxFQUFDO2dCQUNyQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsV0FBVyxFQUFFLENBQUM7YUFDM0M7WUFDRCxJQUFJLENBQUMsVUFBVSxH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TSxHQUFHLEVBQUUsQ0FBQyxTQUFTLENBQUMsTUFBTTtnQkFDOUcsSUFBSSxDQUFDLEtBQUssR0FBRyxhQUFhLENBQUMsdUJBQXVCLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsYUFBYSxDQUFDLHVCQUF1QixDQUFDLFNBQVMsQ0FBQyxFQUFFO29CQUMxSCxPQUFPLEtBQUssQ0FBQztpQkFDZDs7b0JBQU0sT0FBTyxJQUFJLENBQUM7YUFDcEI7UUFDSCxDQUFDLEVBQUE7SUFDSCxDQUFDOztnQkFyTEYsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSxhQUFhO29CQUN2QiwrYkFBMkM7O2lCQUU1Qzs7Ozs7OEJBZUUsS0FBSyxTQUFDLFlBQVk7aUNBY2xCLEtBQUssU0FBQyxlQUFlO2tDQUtyQixNQUFNLFNBQUMsVUFBVTtrQ0FHakIsTUFBTSxTQUFDLFVBQVU7O0lBNklwQiwwQkFBQztDQUFBLEFBdExELElBc0xDO1NBakxZLG1CQUFtQjs7Ozs7O0lBQzlCLG1DQUFzQjs7Ozs7SUFDdEIsOENBQWlFOzs7OztJQUNqRSw4Q0FBaUY7Ozs7O0lBR2pGLDBEQUFrRDs7Ozs7SUFDbEQsMERBQWtEOzs7OztJQUNsRCxnQ0FBcUY7Ozs7O0lBQ3JGLDRDQUEwQzs7Ozs7SUFDMUMseUNBQXVDOzs7OztJQUN2QyxxREFBNkM7O0lBQzdDLDRDQUEyQjs7SUFxQjNCLDhDQUM4Qzs7SUFFOUMsOENBQytFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIEFmdGVyVmlld0NoZWNrZWQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgT25EZXN0cm95IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFRlcm1pbmFsIH0gZnJvbSAneHRlcm0nO1xyXG5pbXBvcnQgKiBhcyBmaXQgZnJvbSAneHRlcm0vbGliL2FkZG9ucy9maXQvZml0JztcclxuaW1wb3J0IHsgTmdUZXJtaW5hbCB9IGZyb20gJy4vbmctdGVybWluYWwnO1xyXG5pbXBvcnQgeyBTdWJqZWN0LCBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgRGlzcGxheU9wdGlvbiB9IGZyb20gJy4vZGlzcGxheS1vcHRpb24nO1xyXG5pbXBvcnQgeyBSZXNpemVFdmVudCB9IGZyb20gJ2FuZ3VsYXItcmVzaXphYmxlLWVsZW1lbnQnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICduZy10ZXJtaW5hbCcsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL25nLXRlcm1pbmFsLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9uZy10ZXJtaW5hbC5jb21wb25lbnQuY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIE5nVGVybWluYWxDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0NoZWNrZWQsIE5nVGVybWluYWwsIE9uRGVzdHJveSB7XHJcbiAgcHJpdmF0ZSB0ZXJtOiBUZXJtaW5hbFxyXG4gIHByaXZhdGUga2V5SW5wdXRTdWJqZWN0OiBTdWJqZWN0PHN0cmluZz4gPSBuZXcgU3ViamVjdDxzdHJpbmc+KCk7XHJcbiAgcHJpdmF0ZSBrZXlFdmVudFN1YmplY3QgPSBuZXcgU3ViamVjdDx7a2V5OiBzdHJpbmc7IGRvbUV2ZW50OiBLZXlib2FyZEV2ZW50O30+KCk7XHJcbiAgXHJcbiAgXHJcbiAgcHJpdmF0ZSBrZXlJbnB1dFN1YmplY3RTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuICBwcml2YXRlIGtleUV2ZW50U3ViamVjdFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG4gIHByaXZhdGUgaCA9IE1hdGgubWF4KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQsIHdpbmRvdy5pbm5lckhlaWdodCB8fCAwKTtcclxuICBwcml2YXRlIGRpc3BsYXlPcHRpb246IERpc3BsYXlPcHRpb24gPSB7fTtcclxuICBwcml2YXRlIGRhdGFTb3VyY2U6IE9ic2VydmFibGU8c3RyaW5nPjtcclxuICBwcml2YXRlIGRhdGFTb3VyY2VTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuICB0ZXJtaW5hbFN0eWxlOiBvYmplY3QgPSB7fTsvLyBoZWlnaHQ6ICh0aGlzLmggLyAyKSArICdweCcgfTtcclxuICBcclxuICBASW5wdXQoJ2RhdGFTb3VyY2UnKVxyXG4gIHNldCBfZGF0YVNvdXJjZShkcykge1xyXG4gICAgaWYodGhpcy5kYXRhU291cmNlU3Vic2NyaXB0aW9uICE9IG51bGwpe1xyXG4gICAgICB0aGlzLmRhdGFTb3VyY2VTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgIH1cclxuICAgIHRoaXMuZGF0YVNvdXJjZSA9IGRzO1xyXG4gICAgdGhpcy5kYXRhU291cmNlU3Vic2NyaXB0aW9uID0gdGhpcy5kYXRhU291cmNlLnN1YnNjcmliZSgoZGF0YSkgPT4ge1xyXG4gICAgICB0aGlzLndyaXRlKGRhdGEpO1xyXG4gICAgfSlcclxuICB9XHJcbiAgZ2V0IF9kYXRhU291cmNlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuZGF0YVNvdXJjZTtcclxuICB9XHJcblxyXG4gIEBJbnB1dCgnZGlzcGxheU9wdGlvbicpXHJcbiAgc2V0IF9kaXNwbGF5T3B0aW9uKG9wdDogRGlzcGxheU9wdGlvbil7XHJcbiAgICB0aGlzLnNldERpc3BsYXlPcHRpb24ob3B0KTtcclxuICB9XHJcblxyXG4gIEBPdXRwdXQoJ2tleUlucHV0JylcclxuICBrZXlJbnB1dEVtaXR0ZXIgID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XHJcblxyXG4gIEBPdXRwdXQoJ2tleUV2ZW50JylcclxuICBrZXlFdmVudEVtaXR0ZXIgID0gbmV3IEV2ZW50RW1pdHRlcjx7a2V5OiBzdHJpbmc7IGRvbUV2ZW50OiBLZXlib2FyZEV2ZW50O30+KCk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkgeyB9XHJcblxyXG4gIHByaXZhdGUgb2JzZXJ2YWJsZVNldHVwKCl7XHJcbiAgICB0aGlzLnRlcm0ub24oJ2RhdGEnLCAoaW5wdXQpID0+IHtcclxuICAgICAgdGhpcy5rZXlJbnB1dFN1YmplY3QubmV4dChpbnB1dCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMudGVybS5vbktleShlID0+IHtcclxuICAgICAgdGhpcy5rZXlFdmVudFN1YmplY3QubmV4dChlKTtcclxuICAgIH0pXHJcbiAgICB0aGlzLmtleUlucHV0U3ViamVjdFN1YnNjcmlwdGlvbiA9IHRoaXMua2V5SW5wdXRTdWJqZWN0LnN1YnNjcmliZSgoZGF0YSkgPT4ge1xyXG4gICAgICB0aGlzLmtleUlucHV0RW1pdHRlci5lbWl0KGRhdGEpO1xyXG4gICAgfSlcclxuICAgIHRoaXMua2V5RXZlbnRTdWJqZWN0U3Vic2NyaXB0aW9uID0gdGhpcy5rZXlFdmVudFN1YmplY3Quc3Vic2NyaWJlKChlKSA9PiB7XHJcbiAgICAgIHRoaXMua2V5RXZlbnRFbWl0dGVyLmVtaXQoZSk7XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogc2V0IGJsb2NrIG9yIGlubGluZS1ibG9jayB0byAjdGVybWluYWwgZm9yIGZpdHRpbmcgY2xpZW50IG9yIG91dGVyIGVsZW1lbnRcclxuICAgKi9cclxuICBwcml2YXRlIHNldFRlcm1pbmFsQmxvY2soaXNCbG9jazogYm9vbGVhbil7XHJcbiAgICBpZihpc0Jsb2NrKVxyXG4gICAgICB0aGlzLnRlcm1pbmFsU3R5bGVbJ2Rpc3BsYXknXSA9ICdibG9jayc7XHJcbiAgICBlbHNlXHJcbiAgICAgIHRoaXMudGVybWluYWxTdHlsZVsnZGlzcGxheSddID0gJ2lubGluZS1ibG9jayc7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBzZXQgZGltZW5zaW9uc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgc2V0VGVybWluYWxEaW1lbnNpb24obGVmdDogbnVtYmVyLCB0b3A6IG51bWJlciwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpIHtcclxuICAgIHRoaXMudGVybWluYWxTdHlsZVsnbGVmdCddID0gYCR7bGVmdH1weGA7XHJcbiAgICB0aGlzLnRlcm1pbmFsU3R5bGVbJ3RvcCddID0gYCR7dG9wfXB4YDtcclxuICAgIHRoaXMudGVybWluYWxTdHlsZVsnd2lkdGgnXSA9IGAke3dpZHRofXB4YDtcclxuICAgIHRoaXMudGVybWluYWxTdHlsZVsnaGVpZ2h0J10gPSBgJHtoZWlnaHR9cHhgO1xyXG4gIH1cclxuICBcclxuICAvKipcclxuICAgKiByZW1vdmUgZGltZW5zaW9uc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVtb3ZlVGVybWluYWxEaW1lbnNpb24oKXtcclxuICAgIHRoaXMudGVybWluYWxTdHlsZVsnbGVmdCddID0gdW5kZWZpbmVkO1xyXG4gICAgdGhpcy50ZXJtaW5hbFN0eWxlWyd0b3AnXSA9IHVuZGVmaW5lZDtcclxuICAgIHRoaXMudGVybWluYWxTdHlsZVsnd2lkdGgnXSA9IHVuZGVmaW5lZDtcclxuICAgIHRoaXMudGVybWluYWxTdHlsZVsnaGVpZ2h0J10gPSB1bmRlZmluZWQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBXaGVuIGEgZGltZW5zaW9uIG9mIGRpdiBjaGFuZ2VzLCBmaXQgYSB0ZXJtaW5hbCBpbiBkaXYuXHJcbiAgICovXHJcbiAgbmdBZnRlclZpZXdDaGVja2VkKCkge1xyXG4gICAgaWYodGhpcy5kaXNwbGF5T3B0aW9uLmZpeGVkR3JpZCA9PSBudWxsKVxyXG4gICAgICBmaXQuZml0KHRoaXMudGVybSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBJdCBjcmVhdGVzIG5ldyB0ZXJtaW5hbCBpbiAjdGVybWluYWwuXHJcbiAgICovXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICBUZXJtaW5hbC5hcHBseUFkZG9uKGZpdCk7ICAvLyBBcHBseSB0aGUgYGZpdGAgYWRkb24gICBcclxuICAgIHRoaXMudGVybSA9IG5ldyBUZXJtaW5hbCgpO1xyXG4gICAgdGhpcy50ZXJtLm9wZW4oZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rlcm1pbmFsJykpO1xyXG4gICAgdGhpcy5vYnNlcnZhYmxlU2V0dXAoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGNsZWFuIGFsbCByZXNvdXJjZXNcclxuICAgKi9cclxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgIGlmKHRoaXMua2V5SW5wdXRTdWJqZWN0U3Vic2NyaXB0aW9uKVxyXG4gICAgICB0aGlzLmtleUlucHV0U3ViamVjdFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgaWYodGhpcy5kYXRhU291cmNlU3Vic2NyaXB0aW9uKVxyXG4gICAgICB0aGlzLmRhdGFTb3VyY2VTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgIGlmKHRoaXMua2V5RXZlbnRTdWJqZWN0U3Vic2NyaXB0aW9uKXtcclxuICAgICAgdGhpcy5rZXlFdmVudFN1YmplY3RTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHdyaXRlKGNoYXJzOiBzdHJpbmcpIHtcclxuICAgIHRoaXMudGVybS53cml0ZShjaGFycyk7XHJcbiAgfVxyXG4gIFxyXG4gIHNldERpc3BsYXlPcHRpb24ob3B0OiBEaXNwbGF5T3B0aW9uKXtcclxuICAgIGlmKG9wdC5maXhlZEdyaWQgIT0gbnVsbCl7XHJcbiAgICAgIGNvbnNvbGUuZGVidWcoXCJyZXNpemFibGUgd2lsbCBiZSBpZ25vcmVkLlwiKVxyXG4gICAgICB0aGlzLnRlcm0ucmVzaXplKG9wdC5maXhlZEdyaWQuY29scywgb3B0LmZpeGVkR3JpZC5yb3dzKTtcclxuICAgICAgdGhpcy5zZXRUZXJtaW5hbEJsb2NrKGZhbHNlKTtcclxuICAgICAgdGhpcy5yZW1vdmVUZXJtaW5hbERpbWVuc2lvbigpO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgIHRoaXMucmVtb3ZlVGVybWluYWxEaW1lbnNpb24oKTtcclxuICAgICAgdGhpcy5zZXRUZXJtaW5hbEJsb2NrKHRydWUpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5kaXNwbGF5T3B0aW9uID0gb3B0O1xyXG4gIH1cclxuXHJcbiAgZ2V0IGtleUlucHV0KCk6IE9ic2VydmFibGU8c3RyaW5nPiB7XHJcbiAgICByZXR1cm4gdGhpcy5rZXlJbnB1dFN1YmplY3Q7XHJcbiAgfVxyXG5cclxuICBnZXQga2V5RXZlbnRJbnB1dCgpOiBPYnNlcnZhYmxlPHtrZXk6IHN0cmluZzsgZG9tRXZlbnQ6IEtleWJvYXJkRXZlbnQ7fT4ge1xyXG4gICAgcmV0dXJuIHRoaXMua2V5RXZlbnRTdWJqZWN0O1xyXG4gIH1cclxuXHJcbiAgZ2V0IHVuZGVybHlpbmcoKTogVGVybWluYWwge1xyXG4gICAgcmV0dXJuIHRoaXMudGVybTtcclxuICB9XHJcblxyXG4gIGdldCBpc0RyYWdnYWJsZU9uRWRnZUFjdGl2YXRlZCgpIHtcclxuICAgIHJldHVybiB0aGlzLmRpc3BsYXlPcHRpb24uYWN0aXZhdGVEcmFnZ2FibGVPbkVkZ2UgIT0gdW5kZWZpbmVkICYmIHRoaXMuZGlzcGxheU9wdGlvbi5maXhlZEdyaWQgPT0gdW5kZWZpbmVkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQWZ0ZXIgdXNlciBjb29yZGluYXRlIGRpbWVuc2lvbnMgb2YgdGVybWluYWwsIGl0J3MgY2FsbGVkLlxyXG4gICAqIEBwYXJhbSBsZWZ0IFxyXG4gICAqIEBwYXJhbSB0b3AgXHJcbiAgICogQHBhcmFtIHdpZHRoIFxyXG4gICAqIEBwYXJhbSBoZWlnaHQgXHJcbiAgICovXHJcbiAgb25SZXNpemVFbmQobGVmdDogbnVtYmVyLCB0b3A6IG51bWJlciwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpOiB2b2lkIHtcclxuICAgIHRoaXMuc2V0VGVybWluYWxEaW1lbnNpb24obGVmdCwgdG9wLCB3aWR0aCwgaGVpZ2h0KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEJlZm9yZSBvblJlc2l6ZUVuZCBpcyBjYWxsZWQsIGl0IHZhbGlhdGVzIGRpbWVuc2lvbnMgdG8gY2hhbmdlLlxyXG4gICAqIEBwYXJhbSByZSBkaW1lbnNpb24gdG8gYmUgc3VibWl0dGVkIGZyb20gcmVzaXphYmxlIHN0dWZmXHJcbiAgICovXHJcbiAgdmFsaWRhdG9yRmFjdG9yeSgpOiAocmU6IFJlc2l6ZUV2ZW50KSA9PiBib29sZWFuIHtcclxuICAgIGNvbnN0IGNvbXAgPSB0aGlzO1xyXG4gICAgcmV0dXJuIChyZTogUmVzaXplRXZlbnQpID0+eyBcclxuICAgICAgY29uc3QgZGlzcGxheU9wdGlvbiA9IGNvbXAuZGlzcGxheU9wdGlvbjtcclxuICAgICAgaWYoZGlzcGxheU9wdGlvbi5hY3RpdmF0ZURyYWdnYWJsZU9uRWRnZSl7XHJcbiAgICAgICAgbGV0IGxlZnQgPSByZS5yZWN0YW5nbGUubGVmdCwgdG9wID0gcmUucmVjdGFuZ2xlLnRvcCwgd2lkdGggPSByZS5yZWN0YW5nbGUud2lkdGgsIGhlaWdodCA9IHJlLnJlY3RhbmdsZS5oZWlnaHQ7XHJcbiAgICAgICAgaWYgKCh3aWR0aCA8IGRpc3BsYXlPcHRpb24uYWN0aXZhdGVEcmFnZ2FibGVPbkVkZ2UubWluV2lkdGgpIHx8IChoZWlnaHQgPCBkaXNwbGF5T3B0aW9uLmFjdGl2YXRlRHJhZ2dhYmxlT25FZGdlLm1pbkhlaWdodCkpIHtcclxuICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9IGVsc2UgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19